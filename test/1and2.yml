
---
- hosts: 192.168.0.104
  collections:
    - fortinet.fortimanager
  connection: httpapi
  vars:
     ansible_httpapi_use_ssl: True
     ansible_httpapi_validate_certs: False
     ansible_httpapi_port: 443
  tasks:
      - name: Add Device
        fmgr_generic:
            method: exec
            params: 
                - url: dvm/cmd/add/device
                  data:
                    adom: SD-WAN-Lab
                    flags:
                        - create_task
                        - nonblocking
                    device:
                        name: "{{deviceName}}"
                        adm_usr: fgtadmin
                        os_ver: 6
                        version: 600
                        os_type: 0
                        mr: 4
                        platform_str: "{{deviceModel}}"
                        mgmt_mode: 3
                        flags: 67371040
                        prefer_img_ver: null
                        sn: "{{deviceSN}}"
                        faz.perm: 15
                        faz.quota: 0
                    groups:
                        name: Warehouse-Group
                        adom: SD-WAN-Lab
       - name: Set Details
         fmgr_dvmdb_device:
            bypass_validation: False
            adom: SD-WAN-Lab
            device: "{{devicename}}"
            dvmdb_device:
               hostname: "{{devicename}}"
               latitude: "{{latitude}}"
               longitude: "{{longitude}}"
               meta fields: 
                  address: "{{citycountry}}"
                  branch-id: "{{branchid}}"
                  remote-dc-id:
                  LAN-IP: "{{LANIP}}"
                  BGP-code: "{{networksubnet}}"
               name: "{{devicename}}"
